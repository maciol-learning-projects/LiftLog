// Database connection to PostgreSQL (Neon)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma Client generator for TypeScript
generator client {
  provider = "prisma-client-js"
}

// Workout status enum - tracks the state of a workout
enum WorkoutStatus {
  DRAFT       // Workout is being planned
  IN_PROGRESS // Workout is currently active
  COMPLETED   // Workout finished successfully
  CANCELLED   // Workout was cancelled
}

// User model - represents an app user
model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String    // hashed with bcrypt
  name      String?   // ADDED: User's display name
  workouts  Workout[]
  workoutHistories WorkoutHistory[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt  // ADDED: Track updates

  @@map("users")
}

// Workout model - represents a training session
model Workout {
  id          Int            @id @default(autoincrement())
  date        DateTime       @default(now())
  user        User           @relation(fields: [userId], references: [id])
  userId      String
  name        String
  exercises   Exercise[]
  notes       String?
  
  // Workout tracking fields
  status      WorkoutStatus  @default(DRAFT)
  startedAt   DateTime?
  completedAt DateTime?
  duration    Int?           // in seconds

  @@map("workouts")
}

// Exercise model - represents a specific exercise in a workout
model Exercise {
  id          Int       @id @default(autoincrement())
  workout     Workout   @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  workoutId   Int
  name        String
  sets        Set[]
  order       Int

  @@map("exercises")
}

// Set model - represents a single set with reps and weight
model Set {
  id          Int       @id @default(autoincrement())
  exercise    Exercise  @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  exerciseId  Int
  reps        Int
  weight      Float?
  order       Int
  
  // Set tracking fields
  completed   Boolean   @default(false)
  completedAt DateTime?
  notes       String?

  @@map("sets")
}

// WorkoutHistory model - represents completed workout snapshots
model WorkoutHistory {
  id          Int      @id @default(autoincrement())
  workoutId   Int
  name        String
  userId      String
  duration    Int?           // in seconds
  completedAt DateTime @default(now())
  exerciseCount Int
  totalSets   Int
  completedSets Int
  notes       String?

  user        User     @relation(fields: [userId], references: [id])
  
  @@map("workout_histories")
}